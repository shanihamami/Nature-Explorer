{% if level is none %}
  {% set level = 0 %}
{% endif %}

<div style="direction: rtl; text-align: right;">
    <!-- הצגת התגובה הראשית -->
    <div class="comment-container" style="margin-left: {{ level * 20 }}px;">
        <p><strong>{{ comment['created_by'] }}:</strong> {{ comment['content'] }} ({{ comment['created_at'][8:10] + "/" + comment['created_at'][5:7] + "/" + comment['created_at'][0:4] }})</p>

        {% if admin %}
            <form method="post" action="{{ url_for('delete_item', item_type='comment', item_id=comment['id']) }}">
                <button type="submit" class="btn btn-danger">מחק תגובה</button>
            </form>
        {% endif %}

        <!-- כפתור לפתיחת טופס התגובה המקוננת -->
        {% if comment['topic_id'] %}
            <button class="btn btn-secondary" onclick="toggleReplyForm('{{ comment['id'] }}')">הגב</button>
            <div id="reply-form-{{ comment['id'] }}" style="display: none; margin-top: 10px;">
                <form method="post" action="{{ url_for('add_comment', topic_id=comment['topic_id']) }}">
                    <input type="hidden" name="parent_comment_id" value="{{ comment['id'] }}">
                    <div class="form-group">
                        <label for="created_by">שם:</label>
                        <input type="text" id="created_by" name="created_by" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="content">תוכן התגובה:</label>
                        <textarea id="content" name="content" class="form-control" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">הוסף תגובה</button>
                </form>
            </div>
        {% else %}
            <!-- אפשרות טיפול במקרה שאין topic_id -->
            <p>לא ניתן להוסיף תגובה כי המידע חסר.</p>
        {% endif %}
    </div>

    <!-- הצגת תגובות מקוננות -->
    {% if comment['replies'] %}
        {% for reply in comment['replies'] %}
            {% set new_level = level + 1 %}
            {% include 'comment_item.html' %}
        {% endfor %}
    {% endif %}
</div>

<script>
function toggleReplyForm(commentId) {
    var form = document.getElementById('reply-form-' + commentId);
    if (form.style.display === 'none' || form.style.display === '') {
        form.style.display = 'block';
    } else {
        form.style.display = 'none';
    }
}
</script>





